<!-- Mermaid.js for diagram rendering -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      themeVariables: {
        fontFamily: 'arial',
        fontSize: '16px'
      },
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true
      }
    });

    // Find all code blocks with language-mermaid class and render them
    const mermaidBlocks = document.querySelectorAll('code.language-mermaid');
    mermaidBlocks.forEach((block, index) => {
      const graphId = 'mermaid-graph-' + index;
      const graphDefinition = block.textContent;
      
      // Create a div to replace the code block
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.textContent = graphDefinition;
      
      // Replace the pre/code block with the mermaid div
      const preBlock = block.parentElement;
      preBlock.parentElement.replaceChild(mermaidDiv, preBlock);
    });

    // Also handle blocks with just class="mermaid" (if any exist)
    const directMermaidBlocks = document.querySelectorAll('.mermaid');
    if (directMermaidBlocks.length > 0) {
      mermaid.run();
    } else {
      // If we converted code blocks, render them
      mermaid.run();
    }
  });
</script>
